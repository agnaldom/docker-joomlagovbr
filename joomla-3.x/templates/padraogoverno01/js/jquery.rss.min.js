/**
 * https://github.com/sdepold/jquery-rss
 */
;(function(e){"use strict";var t=function(t,n,r,i){this.target=t;this.url=n;this.html=[];this.effectQueue=[];this.options=e.extend({ssl:false,limit:null,key:null,layoutTemplate:"<ul>{entries}</ul>",entryTemplate:'<li><a href="{url}">[{author}@{date}] {title}</a><br/>{shortBodyPlain}</li>',tokens:{},outputMode:"json",effect:"show",error:function(){console.log("jQuery RSS: url doesn't link to RSS-Feed")},success:function(){}},r||{});this.callback=i||this.options.success};t.htmlTags=["doctype","html","head","title","base","link","meta","style","script","noscript","body","article","nav","aside","section","header","footer","h1-h6","hgroup","address","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","figure","figcaption","div","table","caption","thead","tbody","tfoot","tr","th","td","col","colgroup","form","fieldset","legend","label","input","button","select","datalist","optgroup","option","textarea","keygen","output","progress","meter","details","summary","command","menu","del","ins","img","iframe","embed","object","param","video","audio","source","canvas","track","map","area","a","em","strong","i","b","u","s","small","abbr","q","cite","dfn","sub","sup","time","code","kbd","samp","var","mark","bdi","bdo","ruby","rt","rp","span","br","wbr"];t.prototype.load=function(t){var n="http"+(this.options.ssl?"s":""),r=n+"://ajax.googleapis.com/ajax/services/feed/load",i=r+"?v=1.0&output="+this.options.outputMode+"&callback=?&q="+encodeURIComponent(this.url);if(this.options.limit!=null)i+="&num="+this.options.limit;if(this.options.key!=null)i+="&key="+this.options.key;e.getJSON(i,t)};t.prototype.render=function(){var t=this;this.load(function(n){try{t.entries=n.responseData.feed.entries}catch(r){t.entries=[];return t.options.error.call(t)}var i=t.generateHTMLForEntries();t.target.append(i.layout);if(i.entries.length!==0){t.appendEntriesAndApplyEffects(e("entries",i.layout),i.entries)}if(t.effectQueue.length>0){t.executeEffectQueue(t.callback)}else{e.isFunction(t.callback)&&t.callback.call(t)}})};t.prototype.appendEntriesAndApplyEffects=function(t,n){var r=this;e.each(n,function(e,n){var i=r.wrapContent(n);if(r.options.effect==="show"){t.before(i)}else{i.css({display:"none"});t.before(i);r.applyEffect(i,r.options.effect)}});t.remove()};t.prototype.generateHTMLForEntries=function(){var t=this,n={entries:[],layout:null};e(this.entries).each(function(){var e=this;if(t.isRelevant(e)){var r=t.evaluateStringForEntry(t.options.entryTemplate,e);n.entries.push(r)}});if(!!this.options.entryTemplate){n.layout=this.wrapContent(this.options.layoutTemplate.replace("{entries}","<entries></entries>"))}else{n.layout=this.wrapContent("<div><entries></entries></div>")}return n};t.prototype.wrapContent=function(t){if(e.trim(t).indexOf("<")!==0){return e("<div>"+t+"</div>")}else{return e(t)}};t.prototype.applyEffect=function(e,t,n){var r=this;switch(t){case"slide":e.slideDown("slow",n);break;case"slideFast":e.slideDown(n);break;case"slideSynced":r.effectQueue.push({element:e,effect:"slide"});break;case"slideFastSynced":r.effectQueue.push({element:e,effect:"slideFast"});break}};t.prototype.executeEffectQueue=function(e){var t=this;this.effectQueue.reverse();var n=function(){var r=t.effectQueue.pop();if(r){t.applyEffect(r.element,r.effect,n)}else{e&&e()}};n()};t.prototype.evaluateStringForEntry=function(t,n){var r=t,i=this;e(t.match(/(\{.*?\})/g)).each(function(){var e=this.toString();r=r.replace(e,i.getValueForToken(e,n))});return r};t.prototype.isRelevant=function(e){var t=this.getTokenMap(e);if(this.options.filter){if(this.options.filterLimit&&this.options.filterLimit==this.html.length){return false}else{return this.options.filter(e,t)}}else{return true}};t.prototype.getTokenMap=function(n){return e.extend({url:n.link,author:n.author,date:n.publishedDate,title:n.title,body:n.content,shortBody:n.contentSnippet,bodyPlain:function(e){var n=e.content.replace(/<script[\\r\\\s\S]*<\/script>/mgi,"").replace(/<\/?[^>]+>/gi,"");for(var r=0;r<t.htmlTags.length;r++){n=n.replace(new RegExp("<"+t.htmlTags[r],"gi"),"")}return n}(n),shortBodyPlain:n.contentSnippet.replace(/<\/?[^>]+>/gi,""),index:e.inArray(n,this.entries),totalEntries:this.entries.length,teaserImage:function(e){try{return e.content.match(/(<img.*?>)/gi)[0]}catch(t){return""}}(n),teaserImageUrl:function(e){try{return e.content.match(/(<img.*?>)/gi)[0].match(/src="(.*?)"/)[1]}catch(t){return""}}(n)},this.options.tokens)};t.prototype.getValueForToken=function(e,t){var n=this.getTokenMap(t),r=e.replace(/[\{\}]/g,""),i=n[r];if(typeof i!="undefined")return typeof i=="function"?i(t,n):i;else throw new Error("Unknown token: "+e)};e.fn.rss=function(e,n,r){(new t(this,e,n,r)).render();return this}})(jQuery);